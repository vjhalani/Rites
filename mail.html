<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mails</title>
    <!-- Bootstrap CSS link -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<style>
    html {
        scroll-behavior: smooth;
    }
    
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        transition: background-color 0.3s ease;
    }
    /* Form styles */
    label {
        display: block;
        margin-bottom: 5px;
    }
    
    input, textarea {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        box-sizing: border-box;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    button {
        cursor: pointer;
        margin-right: 10px;
        text-transform: uppercase;
    }
    
    /* Table styles */
    table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 20px;
    }
    
    th,td {
        border: 3px solid #ddd;
        padding: 12px 8px;
        text-align: left;
    }
    
    th {
        font-size: 0.8rem;
        background-color: #fffcfe;
        color: black;
        font-weight: 600;
        padding: 6px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
 
    h2 { font-size: 1.25rem;
        text-align: left;
        margin-bottom: 15px;
    }

    #claimsDetailsTable th, #claimsDetailsTable td {
        border: none;
        padding: 12px 8px;
        border-bottom: 1px solid #ddd;
    }
    #claimsDetailsTable th {
        font-weight: normal;
        border-bottom: 2px solid #ddd;
    }
</style>
</head>

<body>
    
    <div id="popupOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); align-items: center; justify-content: center; z-index: 999;color: black;">
        <div style="background: white; padding: 20px; border-radius: 5px;">
            <p id="popupMessage"></p>
        </div>
    </div>

    <div class="container" style="padding-top:3%;">
        <form id="emailForm">
             <label for="vendorDetails" style="font-weight: bold;">VENDOR DETAILS:</label>
             <table class="table" id="vendorDetailsTable" style="box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); width: 100%; border-collapse: collapse; border-top: 2px solid #ddd;">
                <thead>
                    <tr>
                        <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Feed ID</th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Type</th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Title</th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">SKU</th>
                        <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Service</th>
                        <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Seller</th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                        <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="vendorRow">
                        <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control feedid" id="feedId" required></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control type" required disabled></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control title" required disabled></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control sku" required disabled></td>
                        <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control category" id="serviceName" required disabled></td>
                        <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control seller" id="vendorName" required disabled></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control blank" id="vendorName" required></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control blank" id="vendorName" required></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control blank" id="vendorName" required></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control blank" id="vendorName" required></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control blank" id="vendorName" required></td>
                        <td style="display: none; border: none;"><input type="text" class="form-control blank" id="vendorName" required></td>
                    </tr>
                </tbody>
            </table>
                                    
            <label for="claimsDetails" style="font-weight: bold; padding-top: 20px;">CLAIM DETAILS:</label>
            <div class="table-responsive">
                <table class="table" id="claimsDetailsTable" style="box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); width: 100%; border-collapse: collapse; border-top: 2px solid #ddd;">
                    <thead>
                        <tr>
                            <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">S.No</th>
                            <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Department Name</th>
                            <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Work Order Number</th>
                            <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Project Value</th>
                            <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Project Start Date</th>
                            <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Project End Date</th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; display: none; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;"></th>
                            <th style="font-weight: normal; border: none; border-bottom: 2px solid #ddd; padding: 12px 8px;">Buyer Designation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="claimRow" id="claimRow">
                            <td style="border: none; padding: 12px 8px;">
                                <button type="button" id="clearAllButton" class="btn btn-light" onclick="clearClaimsDetailsTable()">Clear</button>
                            </td>
                            <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control buyerDepartment" required></td>
                            <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control workOrderNumber" required disabled></td>
                            <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control projectValue" required disabled></td>
                            <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control startDate" required disabled></td>
                            <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control endDate" required disabled></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="display:none; border: none;"><input type="text" class="form-control" required></td>
                            <td style="border: none; padding: 12px 8px;"><input type="text" class="form-control BuyerDesignation" required disabled></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="buttons row" style="padding: 15px 2px 5px 2px; align-items: center; justify-content: center;">
                <div class="col-12 col-md-3 mb-2">
                    <button type="button" class="btn btn-secondary w-100 rounded-pill text-uppercase" style="background-color:#896790; border: none;" onclick="copyToClipboard()">Copy Mail</button>
                </div>
                <div class="col-12 col-md-3 mb-2">
                    <button type="button" class="btn btn-secondary w-100 rounded-pill text-uppercase" style="background-color:#896790; border: none;" onclick="copySubject()">Copy Subject</button>
                </div>
                <div class="col-12 col-md-3 mb-2">
                    <button type="button" class="btn btn-secondary w-100 rounded-pill text-uppercase" style="background-color:#896790; border: none;" onclick="copyToGSheet()">Copy Record</button>
                </div>
            </div>
               
        </form>
       <hr>
        <h5 style="text-align: center; letter-spacing: 1px; font-weight: normal;"><U>PREVIEW</U></h5>
         <div id="emailSubject" style="visibility: none;"></div>
        <div id="emailPreview"></div>
    </div>
    <script>
    // Select the feedid input field using its class
    const feedIdInput = document.querySelector('.feedid');
    const buyerDepartmentInput = document.querySelector('.buyerDepartment');

    // Initially, keep the buyerDepartment field disabled
    buyerDepartmentInput.disabled = true;

    // Add an event listener for the paste event on the feedid field
    feedIdInput.addEventListener('paste', function (e) {
        // Wait for the data to be pasted
        setTimeout(function () {
            // Disable the feedId input after data is pasted
            feedIdInput.disabled = true;

            // Enable the buyerDepartment field after the data is pasted
            buyerDepartmentInput.disabled = false;
        }, 0);
    });
    </script>
    <script>
function clearClaimsDetailsTable() {
    // Clear rows in the claims details table (except the first row)
    var claimsDetailsTable = document.getElementById('claimsDetailsTable');
    var claimsDetailsBody = claimsDetailsTable.getElementsByTagName('tbody')[0];

    // Getting all rows in the table body
    var rows = claimsDetailsBody.getElementsByTagName('tr');

    // Iterating from the second row (index 1) to the last row and removing them
    while (rows.length > 1) {
        claimsDetailsBody.removeChild(rows[1]);
    }

    // Clear the generated mail content
    var generatedMail = document.getElementById('generatedMail');
    if (generatedMail) {
        generatedMail.textContent = ''; // Clear the mail content
    }

    // Clear the email preview and subject
    document.getElementById('emailPreview').innerHTML = ''; // Clear the email preview content
    document.getElementById('emailSubject').innerText = ''; // Clear the email subject
}

// event listener to the clear button
document.getElementById('clearAllButton').addEventListener('click', clearClaimsDetailsTable);
    </script>

    <script>
    function generateEmail() {
        var vendorName = document.getElementById('vendorDetailsTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[0].getElementsByClassName('seller')[0].value;
        var serviceName = document.getElementById('vendorDetailsTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[0].getElementsByClassName('category')[0].value;
        var feedId = document.getElementById('vendorDetailsTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[0].getElementsByClassName('feedid')[0].value;

        var claimsDetailsTable = document.getElementById('claimsDetailsTable');
        var claimsDetailsBody = claimsDetailsTable.getElementsByTagName('tbody')[0];
        var rows = claimsDetailsBody.getElementsByTagName('tr');
        var claimsDetails = '';

        for (var i = 1; i < rows.length; i++) { // Start from 1 to exclude header row
            var cells = rows[i].getElementsByTagName('td');
            var buyerDepartment = cells[1].textContent;
            var workOrderNumber = cells[2].textContent;
            var projectValue = cells[3].textContent;
            var startDate = cells[4].textContent;
            var endDate = cells[5].textContent;
            var buyerDesignation = cells[14].textContent;

            claimsDetails += `<tr>
                                <td>${i}</td>
                                <td>${workOrderNumber}</td>
                                <td>${projectValue}</td>
                                <td>${startDate}</td>
                                <td>${endDate}</td>
                                <td></td>
                                <td></td>
                            </tr>`;
        }
        var buyerName = buyerDesignation + ', ' + buyerDepartment; // Concatenate buyer name with designation and department separated by comma
        var subject = `To seek confirmation regarding ${vendorName} registering as a service provider on the GeM portal.`;
        var emailTemplate = `Dear Sir/Ma’am,<br>
        Greetings from GeM!<br>
        <br>
        This is to seek confirmation regarding <b>${vendorName}</b> registering as a service provider on the GeM portal. The seller claims to have provided the following:<br>
        <br>
        <b>Service Name:</b> ${serviceName}<br>
        <b>Buyer Name:</b> ${buyerName}<br>
        <br>
        Below are the details shared by the service provider (Feed ID: <b>${feedId}</b>) on the GeM portal for further verification.<br>
        <br>
        <table style="border: 1px solid black; border-collapse: collapse;">
            <tr>
                <th rowspan="2">S.No.</th>
                <th colspan="4">Claims as per the Service Provider</th>
                <th colspan="2">To be filled by the recipient department</th>
            </tr>
            <tr>
                <th>Work Order Number</th>
                <th>Project Value</th>
                <th>Project Start Date</th>
                <th>Project End Date</th>
                <th>Confirmation (Y/N)</th>
                <th>Remarks(If any)</th>
            </tr>
            ${claimsDetails}
        </table>
        <br>
        <i><b>Note:</b> The completion document/work order/relevant documents (the document uploaded by the service provider) has been attached for your reference.</i><br>
        <br>
        Please revert to the same mail in Yes/No if credentials mentioned above are correct as per your records.<br>
        <br>
        Yes–If documents/details provided are authentic<br>
        No–If documents/details provided are not authentic<br>
        <br>
        In this regard, we request you to please confirm whether the document submitted by the service provider is true and correct or not, The document uploaded by the service provider has been attached for your reference.<br>
        <br>
        Request you to please reply to the mail at the earliest of your convenience or within the next 4 days. In case of any query, please contact the undersigned.<br>
        <br>
        Also, please be informed that the GeM is a trust-based portal and therefore, it is imminent to verify the documents submitted by the service providers from the concerned Buyer department, otherwise, it may lead to possible forgery at the GeM portal. Considering the gravity of the situation, we request you to please take this on an urgent basis.<br>
        <br>
        Thanking You,<br>
        Ganesh K Ingole<br>
        Contact: 8600017722<br>
        Government e-Marketplace (GeM)<br>
        Ministry of Commerce & Industry`;
        
        document.getElementById('emailPreview').innerHTML = emailTemplate;
        document.getElementById('emailSubject').innerText = subject;
        document.getElementById('claimRow').scrollIntoView(); // Scroll down while pressing generate button
    }

    // Event listener to email generatE on input or change
    var claimsDetailsTable = document.getElementById('claimsDetailsTable');
    
    claimsDetailsTable.addEventListener('input', function() {
        generateEmail();
    });

    claimsDetailsTable.addEventListener('change', function() {
        generateEmail();
    });

    // Add paste event listener to handle pasting rows
    claimsDetailsTable.addEventListener('paste', function() {
        setTimeout(generateEmail, 0); // Use timeout to wait for paste to finish
    });
    
    function showPopup(message) {
        // Set the popup message
        document.getElementById('popupMessage').innerText = message;

        // Show the overlay
        document.getElementById('popupOverlay').style.display = 'flex';

        // Hide the overlay after 3 seconds
        setTimeout(function () {
            document.getElementById('popupOverlay').style.display = 'none';
        }, 1000);
    }

    function copyToClipboard() {
            var emailPreview = document.getElementById('emailPreview');
            var range = document.createRange();
            range.selectNode(emailPreview);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            showPopup('Email Copied to Clipboard!');
        }

    function copySubject() {
            var emailSub = document.getElementById('emailSubject');
            var range = document.createRange();
            range.selectNode(emailSub);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            showPopup('Subject Copied to Clipboard!');
        }

        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });  
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.8/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
                document.addEventListener('DOMContentLoaded', function () {
                    document.getElementById('claimsDetailsTable').addEventListener('paste', handlePaste);
                });
        function handlePaste(e) {
            var clipboardData, pastedData;

            // Get clipboard data
            clipboardData = e.clipboardData || window.clipboardData;
            pastedData = clipboardData.getData('text');

            // Split pasted data into rows and columns
            var rows = pastedData.split('\n');

            // Get the tbody element of the claimsDetailsTable
            var tbody = document.getElementById('claimsDetailsTable').getElementsByTagName('tbody')[0];

            // Get the current number of rows in the table
            var existingRowCount = tbody.getElementsByTagName('tr').length;

            // Create a new row for pasted data
            var newRow = document.createElement('tr');

            // Create and append the serial number cell
            var serialNumberCell = document.createElement('td');
            serialNumberCell.textContent = existingRowCount; // Serial number for the new row
            newRow.appendChild(serialNumberCell);

            // Loop through each row of pasted data
            for (var i = 0; i < rows.length; i++) {
                var rowData = rows[i].split('\t');

                // Loop through each column of pasted data
                for (var j = 0; j < 5; j++) { // Loop through first 5 columns
                    var newCell = document.createElement('td');
                    newCell.textContent = rowData[j];
                    newRow.appendChild(newCell);
                }

                // Add the last column
                var lastColumnCell = document.createElement('td');
                lastColumnCell.textContent = rowData[rowData.length - 1]; // Last column
                newRow.appendChild(lastColumnCell);
            }

            // Append the new row to the tbody
            tbody.appendChild(newRow);

            // Hide the columns to hide
            hideColumns();

            e.preventDefault(); // To Prevent default paste behavior
        }

        function hideColumns() {
            var tableRows = document.getElementById('claimsDetailsTable').getElementsByTagName('tr');
            for (var i = 0; i < tableRows.length; i++) {
                var cells = tableRows[i].getElementsByTagName('td');
                for (var j = 1; j < cells.length - 1; j++) { // Hide columns except the first 5 and the last column
                    if (j <= 5 || j === cells.length - 1) { // Show first 5 and last column, hide the rest
                        cells[j].style.display = '';
                    } else {
                        cells[j].style.display = 'none';
                    }
                }
            }
        }
        function copyToGSheet() {
            var vendorDetailsTable = document.getElementById('vendorDetailsTable');
            var vendorDetailsBody = vendorDetailsTable.getElementsByTagName('tbody')[0];
            var rows = vendorDetailsBody.getElementsByTagName('tr');
            var dataToCopy = [];

            // Get current date in the desired format
            var currentDate = new Date();
            var options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            var formattedDate = currentDate.toLocaleDateString('en-US', options);

            for (var i = 0; i < rows.length; i++) {
                var cells = rows[i].getElementsByTagName('td');
                var rowData = [];

                for (var j = 0; j < cells.length; j++) {
                    var cellData = cells[j].querySelector('input') ? cells[j].querySelector('input').value : cells[j].innerText;
                    // Replacing "pending" with "In-Progress" in the last column
                    if (j === cells.length - 1 && cellData.toLowerCase() === "pending") {
                        cellData = "In-Progress";
                    }
                    rowData.push(cellData);
                }
                // Add the formatted date in the last column
                rowData.push(formattedDate);
                dataToCopy.push(rowData.join('\t')); // Tab-separated values for Google Sheets
            }

            // Copy data to clipboard
            navigator.clipboard.writeText(dataToCopy.join('\n')).then(function() {
                showPopup('Data Copied to Clipboard!');
                // alert("Data copied to clipboard!");
            }, function(err) {
                console.error("Could not copy text: ", err);
            });
}

        function handleVendorPaste(e) {
            var clipboardData, pastedData;

            // Get clipboard data
            clipboardData = e.clipboardData || window.clipboardData;
            pastedData = clipboardData.getData('text');

            // Split pasted data into rows and columns
            var rows = pastedData.split('\n');
            var firstRowCells = document.getElementById('vendorDetailsTable').getElementsByTagName('tbody')[0].getElementsByTagName('tr')[0].getElementsByTagName('td');

            // Loop through each row of pasted data
            for (var i = 0; i < rows.length; i++) {
                var rowData = rows[i].split('\t');
                if (rowData.length !== firstRowCells.length) {
                    alert('Pasted data does not have the correct number of columns.');
                    return;
                }

                // Update the cells of the first row with pasted data
                for (var j = 0; j < rowData.length; j++) {
                    // Check if the cell exists
                    if (firstRowCells[j]) {
                        // Update the cell value
                        firstRowCells[j].getElementsByTagName('input')[0].value = rowData[j].trim();
                    } else {
                        // If the number of cells in the pasted data exceeds the number of cells in the table, add a new row
                        var newRow = document.createElement('tr');
                        for (var k = 0; k < rowData.length; k++) {
                            var newCell = document.createElement('td');
                            newCell.innerHTML = '<input type="text" class="form-control" value="' + rowData[k].trim() + '" required>';
                            newRow.appendChild(newCell);
                        }
                        document.getElementById('vendorDetailsTable').getElementsByTagName('tbody')[0].appendChild(newRow);
                    }
                }
            }

            e.preventDefault(); // Prevent default paste behavior
        }

        // Attach the handleVendorPaste function to the paste event of the vendorDetailsTable
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('vendorDetailsTable').addEventListener('paste', handleVendorPaste);
        });
    </script>
</body>
</html>
